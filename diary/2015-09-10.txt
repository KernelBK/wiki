
"原工程在改动后未CLEAN", 原来的FPGA工程编译前做过clean.
重新编译以，不会再每次都出现spi接口发送控制信号，但仍有问题。
如果问题和编译过程相关，那么由于时序引起问题的可能性比较大，因此今天先把时序报告中的错误全部约束正确，然后再检查Warning里面和时序有关的报告。
这个检查还需要明天半天的工作量。



华丕祥(huapixiang) 2015-09-09 20:16:18
PA5000功率卡配置问题已经找到原因：
①在未CLEAN状态下编译工程（即启用增量编译），未添加正确的时序约束，在系统关机时，功率卡上FPGA总是会在power_ctrl下降沿后800us左右出现写FLASH操作，操作码随机，经过逻辑分析仪抓取大量数据发现，只要是配置不正常之前都有发生写FLASH操作。
②添加时序约束，CLEAN状态下重新编译，在系统关机时，功率卡上FPGA偶尔会在power_ctrl下降沿后800us左右出现向FLASH发送数据的情况，但操作码和数据均为0，FLASH不会被改写。经测试长时间不断开关power_ctrl均未出现不能正确配置现像。

总结：
     ①主要原因是原工程在改动后未CLEAN，增时编译可能出错，且静态时序报告远达不到目标要求，时序受温度、电压和设计的影响，在本身达不到要求的情况下当电压降低时（发生写FLASH的时间总是在power关闭后的800us时间出现，此时由于有退耦电容原因，内核电压已经下降到比较大的幅度）极易触发时序问题。
    ②目前功率卡的FLASH操作主要由软核，硬件只做SPI时序发生器，像写FLASH这种关键使命的任务，需要考虑多重保险，即需要在软核和SPI时序发生接口处，增加序列保护和解保护功能，因为在时序出问题时不能保证AXI4总线上的数据是正确的，如果直接由SPI发送出去则风险极大。


@杨耀武: 
①增加正确的时序约束，以后有改动时建议工程和EDK均全部CLEAN后再编译
②建议在SPI接口的AXI总线处做序列检测，如果符合序列的数据后才能通过SPI发送数据到FLASH，否则不放行，这个能解决在添加正确时序约束后电压下降到一定程度时仍有极小概率往外发送数据的现像。
刘玉才(liuyucai) 2015-09-09 21:05:06
辛苦了，这个问题做好记录，@杨耀武 按照华丕祥的结论明天处理好，以后排查问题的方法上和华丕祥，芮工多学习探讨一下。

